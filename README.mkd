# ğŸ›ï¸ AllinBuy - Backend API

![PHP](https://img.shields.io/badge/PHP-8.0+-777BB4?style=flat&logo=php&logoColor=white)
![MySQL](https://img.shields.io/badge/MySQL-8.0+-4479A1?style=flat&logo=mysql&logoColor=white)
![Apache](https://img.shields.io/badge/Apache-2.4+-D22128?style=flat&logo=apache&logoColor=white)
![REST API](https://img.shields.io/badge/REST-API-61DAFB?style=flat&logo=api&logoColor=white)

**AllinBuy** es una plataforma de marketplace que conecta emprendedores locales con compradores, desarrollada como proyecto universitario para los cursos de **Desarrollo de Software**, **Redes de Computadoras I**, **ComputaciÃ³n GrÃ¡fica II**, **Sistemas Embebidos** y **Seminario de InvestigaciÃ³n I**.

Este repositorio contiene el **backend** desarrollado en PHP con arquitectura REST API, diseÃ±ado para ser consumido por un frontend en Next.js.

## ğŸŒŸ CaracterÃ­sticas

- âœ… **API REST** completa con endpoints para productos, usuarios, carrito y pedidos
- âœ… **AutenticaciÃ³n** de usuarios con sistema de registro y login
- âœ… **GestiÃ³n de productos** con categorÃ­as, stock y precios
- âœ… **Carrito de compras** persistente por usuario
- âœ… **Sistema de pedidos** completo con tracking de estados
- âœ… **CORS** configurado para frontend Next.js
- âœ… **Base de datos** MySQL con estructura normalizada
- âœ… **DocumentaciÃ³n** completa de endpoints
- âœ… **Testing** integrado con interfaz web

## ğŸ› ï¸ TecnologÃ­as

| TecnologÃ­a | VersiÃ³n | PropÃ³sito |
|------------|---------|-----------|
| **PHP** | 8.0+ | Lenguaje del backend |
| **MySQL** | 8.0+ | Base de datos principal |
| **Apache** | 2.4+ | Servidor web |
| **PDO** | - | AbstracciÃ³n de base de datos |
| **JSON** | - | Formato de respuesta API |

## ğŸ“ Estructura del Proyecto

```
backend-allin-buy/
â”œâ”€â”€ ğŸ“„ README.md
â”œâ”€â”€ ğŸ“„ package.json               # Dependencias Node.js (herramientas desarrollo)
â”œâ”€â”€ ğŸ“„ package-lock.json
â”œâ”€â”€ ğŸ“„ .gitignore
â”œâ”€â”€ ğŸ“„ test_api.html             # Interfaz de pruebas completa
â”œâ”€â”€ ğŸ“‚ php/
â”‚   â”œâ”€â”€ ğŸ“‚ api/                  # Endpoints de la API REST
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ productos.php     # CRUD productos + bÃºsqueda
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ usuarios.php      # Registro, login, perfil
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ carrito.php       # GestiÃ³n carrito de compras
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ pedidos.php       # Sistema de pedidos
â”‚   â”‚   â””â”€â”€ ğŸ“„ categorias.php    # GestiÃ³n de categorÃ­as
â”‚   â”œâ”€â”€ ğŸ“‚ config/               # ConfiguraciÃ³n del sistema
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ database.php      # ConexiÃ³n BD + helpers
â”‚   â”‚   â””â”€â”€ ğŸ“„ cors.php          # ConfiguraciÃ³n CORS
â”‚   â””â”€â”€ ğŸ“‚ test/                 # Archivos de prueba
â””â”€â”€ ğŸ“‚ src/                      # Archivos adicionales (si los hay)
```

## ğŸ”§ Requisitos Previos

AsegÃºrate de tener instalado:

- **XAMPP** (Apache + MySQL + PHP) o stack similar
  - PHP 8.0 o superior
  - MySQL 8.0 o superior
  - Apache 2.4 o superior
- **Git** para clonaciÃ³n del repositorio
- **Navegador web** moderno para pruebas

### Verificar instalaciÃ³n:
```bash
php --version    # Debe mostrar PHP 8.0+
mysql --version  # Debe mostrar MySQL 8.0+
```

## ğŸš€ InstalaciÃ³n y ConfiguraciÃ³n

### 1. Clonar el Repositorio
```bash
git clone https://github.com/ciro8014/backend-allin-buy.git
cd backend-allin-buy
```

### 2. Configurar el Servidor Web

**OpciÃ³n A: XAMPP**
1. Copia el proyecto a `C:\xampp\htdocs\backend-allin-buy\`
2. Inicia Apache y MySQL desde el panel de XAMPP
3. La aplicaciÃ³n estarÃ¡ disponible en `http://localhost/backend-allin-buy/`

**OpciÃ³n B: Servidor PHP integrado**
```bash
cd backend-allin-buy
php -S localhost:8000
```

### 3. Configurar la Base de Datos

#### Crear la base de datos:
```sql
CREATE DATABASE allin_buy CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### Ejecutar script de tablas:
```sql
-- Usar el archivo create_database.sql (crear segÃºn estructura del proyecto)
-- O ejecutar las consultas para crear las tablas necesarias
```

#### Configurar credenciales:
Edita `php/config/database.php` con tus credenciales:
```php
define('DB_HOST', 'localhost');
define('DB_NAME', 'allin_buy');
define('DB_USER', 'root');          // Tu usuario MySQL
define('DB_PASS', 'tu_password');   // Tu contraseÃ±a MySQL
```

### 4. Verificar InstalaciÃ³n

Accede a: `http://localhost:8000/php/config/database.php`

DeberÃ­as ver una pÃ¡gina de verificaciÃ³n que muestra:
- âœ… ConexiÃ³n exitosa a la base de datos
- âœ… Tablas creadas correctamente
- âœ… Datos de prueba disponibles

### 5. Insertar Datos de Prueba (Opcional)

La primera vez, el sistema puede insertar datos de prueba automÃ¡ticamente. Si no:
```
http://localhost:8000/php/config/database.php?action=insert_sample
```

## ğŸ”Œ ConfiguraciÃ³n para Frontend

Si vas a conectar con un frontend Next.js:

1. **Verifica CORS** en `php/config/cors.php`:
```php
$allowedOrigins = [
    'http://localhost:3000',    // Next.js development
    'https://tu-dominio.com'    // ProducciÃ³n
];
```

2. **En tu frontend**, configura la URL base:
```javascript
// .env.local en Next.js
NEXT_PUBLIC_API_URL=http://localhost:8000/php/api
```

## ğŸ“š DocumentaciÃ³n de la API

### Base URL
```
http://localhost:8000/php/api
```

### Endpoints Principales

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| `GET` | `/productos.php` | Listar todos los productos |
| `GET` | `/productos.php/destacados` | Productos destacados |
| `GET` | `/productos.php/{id}` | Obtener producto especÃ­fico |
| `POST` | `/productos.php` | Crear nuevo producto |
| `PUT` | `/productos.php/{id}` | Actualizar producto |
| `DELETE` | `/productos.php/{id}` | Eliminar producto |

#### Ejemplos de Uso:

**Obtener productos:**
```bash
curl -X GET "http://localhost:8000/php/api/productos.php"
```

**Crear producto:**
```bash
curl -X POST "http://localhost:8000/php/api/productos.php" \
  -H "Content-Type: application/json" \
  -d '{
    "nombre": "Producto Ejemplo",
    "precio": 29.99,
    "stock": 50,
    "categoria_id": 1,
    "descripcion": "DescripciÃ³n del producto"
  }'
```

### Usuarios

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| `POST` | `/usuarios.php/registro` | Registrar usuario |
| `POST` | `/usuarios.php/login` | Iniciar sesiÃ³n |
| `GET` | `/usuarios.php/perfil/{id}` | Obtener perfil |
| `PUT` | `/usuarios.php/{id}` | Actualizar usuario |

**Ejemplo - Registro:**
```bash
curl -X POST "http://localhost:8000/php/api/usuarios.php/registro" \
  -H "Content-Type: application/json" \
  -d '{
    "nombre": "Juan",
    "apellido": "PÃ©rez",
    "email": "juan@ejemplo.com",
    "password": "123456",
    "telefono": "999999999"
  }'
```

### Carrito

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| `GET` | `/carrito.php/{usuario_id}` | Ver carrito |
| `POST` | `/carrito.php/{usuario_id}` | Agregar producto |
| `PUT` | `/carrito.php/{usuario_id}/{producto_id}` | Actualizar cantidad |
| `DELETE` | `/carrito.php/{usuario_id}/{producto_id}` | Eliminar producto |
| `DELETE` | `/carrito.php/{usuario_id}/limpiar` | Limpiar carrito |

### Pedidos

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| `GET` | `/pedidos.php` | Listar pedidos |
| `POST` | `/pedidos.php/crear` | Crear pedido desde carrito |
| `GET` | `/pedidos.php/usuario/{id}` | Pedidos de usuario |
| `PUT` | `/pedidos.php/{id}` | Actualizar estado |

## ğŸ§ª Pruebas

### Interfaz de Pruebas Web
Accede a: `http://localhost:8000/test_api.html`

Esta interfaz permite:
- âœ… Probar todos los endpoints
- âœ… Ver respuestas en tiempo real
- âœ… Simular flujos completos de usuario
- âœ… Verificar cÃ³digos de estado HTTP

### Pruebas Manuales con cURL

**Flujo completo de prueba:**
```bash
# 1. Registrar usuario
curl -X POST "http://localhost:8000/php/api/usuarios.php/registro" \
  -H "Content-Type: application/json" \
  -d '{"nombre":"Test","apellido":"User","email":"test@test.com","password":"123456"}'

# 2. Hacer login
curl -X POST "http://localhost:8000/php/api/usuarios.php/login" \
  -H "Content-Type: application/json" \
  -d '{"email":"test@test.com","password":"123456"}'

# 3. Ver productos
curl -X GET "http://localhost:8000/php/api/productos.php"

# 4. Agregar al carrito
curl -X POST "http://localhost:8000/php/api/carrito.php/1" \
  -H "Content-Type: application/json" \
  -d '{"producto_id":1,"cantidad":2}'

# 5. Crear pedido
curl -X POST "http://localhost:8000/php/api/pedidos.php/crear" \
  -H "Content-Type: application/json" \
  -d '{"usuario_id":1,"metodo_pago":"tarjeta","direccion_envio":"Lima, PerÃº"}'
```

## ğŸ” ResoluciÃ³n de Problemas

### Error: "ConexiÃ³n a base de datos fallÃ³"
- Verifica que MySQL estÃ© ejecutÃ¡ndose
- Confirma credenciales en `php/config/database.php`
- AsegÃºrate de que la base de datos `allin_buy` exista

### Error: "CORS policy"
- Verifica configuraciÃ³n en `php/config/cors.php`
- AsegÃºrate de que el frontend estÃ© en la lista de orÃ­genes permitidos

### Error: "404 Not Found"
- Verifica que Apache estÃ© ejecutÃ¡ndose
- Confirma la ruta correcta: `http://localhost:8000/php/api/`
- Revisa configuraciÃ³n de mod_rewrite si usas Apache

### Error: "500 Internal Server Error"
- Revisa logs de PHP: `tail -f /var/log/apache2/error.log`
- Verifica permisos de archivos
- Confirma sintaxis PHP

## ğŸ—ï¸ Arquitectura del Proyecto

### Patrones Utilizados
- **REST API**: Arquitectura orientada a servicios
- **MVC Simplificado**: SeparaciÃ³n de lÃ³gica y datos
- **Singleton**: Para conexiÃ³n de base de datos
- **Factory Pattern**: Para respuestas JSON estandarizadas

### Seguridad Implementada
- ğŸ” **Prepared Statements**: PrevenciÃ³n de SQL injection
- ğŸ” **Password Hashing**: EncriptaciÃ³n de contraseÃ±as
- ğŸ” **Input Validation**: ValidaciÃ³n de datos de entrada
- ğŸ” **CORS Security**: Control de orÃ­genes permitidos

## ğŸ“Š Base de Datos

### Diagrama de Entidades (Principal)
```
usuarios (id, nombre, email, password, ...)
    â”‚
    â”œâ”€â”€ carrito (usuario_id, producto_id, cantidad)
    â”‚
    â””â”€â”€ pedidos (id, usuario_id, total, estado, ...)
            â”‚
            â””â”€â”€ pedido_detalles (pedido_id, producto_id, cantidad, precio)

productos (id, nombre, precio, stock, categoria_id, ...)
    â”‚
    â””â”€â”€ categorias (id, nombre, descripcion, ...)
```

## ğŸ¤ ContribuciÃ³n

Si eres compaÃ±ero de clase y quieres contribuir:

1. Fork el proyecto
2. Crea una rama: `git checkout -b feature/nueva-funcionalidad`
3. Commit tus cambios: `git commit -m 'Agregar nueva funcionalidad'`
4. Push a la rama: `git push origin feature/nueva-funcionalidad`
5. Abre un Pull Request

## ğŸ“„ Licencia

Este proyecto es para fines educativos del curso de **Desarrollo de Software** en la Universidad Nacional de San Antonio Abad del Cusco (UNSAAC).

## ğŸ‘¨â€ğŸ’» Autor

**Ciro** - [ciro8014](https://github.com/ciro8014)
- Estudiante de IngenierÃ­a InformÃ¡tica y de Sistemas
- UNSAAC - 2024

## ğŸ“ Soporte

Si encuentras algÃºn problema:
1. Revisa la secciÃ³n [ResoluciÃ³n de Problemas](#-resoluciÃ³n-de-problemas)
2. Usa la [interfaz de pruebas](#interfaz-de-pruebas-web) para debugging
3. Abre un issue en GitHub con detalles del error

---

### ğŸ¯ Objetivos AcadÃ©micos Cumplidos

- âœ… **Desarrollo de Software**: API REST completa con CRUD
- âœ… **Redes de Computadoras I**: Protocolos HTTP, CORS, cliente-servidor
- âœ… **Bases de Datos**: DiseÃ±o normalizado, consultas optimizadas
- âœ… **IngenierÃ­a de Software**: DocumentaciÃ³n, testing, patrones de diseÃ±o

**Â¡Gracias por revisar nuestro proyecto! ğŸš€**